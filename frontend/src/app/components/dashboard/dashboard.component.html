<div class="grid">
    <div class="cell">
        <div class="label">Bot</div>
        <div class="value" [class.on]="running" [class.off]="!running">
            {{ running ? 'RUNNING' : 'STOPPED' }}
        </div>
        <div class="muted">symbol: <b>{{ symbol || (cfg?.strategy?.symbol || '—') }}</b></div>
    </div>

    <div class="cell">
        <div class="label">WebSocket</div>
        <div class="value">{{ ws.ws_clients }} кл.</div>
        <div class="muted">rate: {{ ws.ws_rate | number:'1.0-2' }} msg/s</div>
    </div>

    <div class="cell">
        <div class="label">Metrics</div>
        <div class="muted">orders_total: {{ metrics?.orders_total || 0 }}</div>
        <div class="muted">orders_active: {{ metrics?.orders_active || 0 }}</div>
        <div class="muted">orders_filled: {{ metrics?.orders_filled || 0 }}</div>
        <div class="muted">ticks_total: {{ metrics?.ticks_total || 0 }}</div>
        <div class="muted">funds_in_use: {{ (metrics?.funds_in_use || 0) | number:'1.2-2' }}</div>
        <div class="muted">funds_reserve: {{ (metrics?.funds_reserve || 0) | number:'1.2-2' }}</div>
    </div>
</div>

<div class="grid" style="margin-top:12px">
    <div class="cell">
        <div class="label">Market</div>
        <div *ngIf="market?.symbol; else noMkt" class="mono">
            {{ market.symbol }}<br>
            bid: {{ market.bid || '—' }} | ask: {{ market.ask || '—' }} | last: {{ market.last || '—' }}
            <div class="muted">ts: {{ market.ts | date:'medium' }}</div>
        </div>
        <ng-template #noMkt><div class="muted">нет данных (запусти бота)</div></ng-template>
    </div>

    <div class="cell" style="grid-column: span 2;">
        <div class="label">Last diag</div>
        <div class="mono">{{ lastDiag || '—' }}</div>
    </div>
</div>

<!-- ✅ Новый блок: Equity Sparkline + KPI -->
<div class="grid" style="margin-top:12px">
    <div class="cell" style="grid-column: span 3;">
        <div class="label">Equity (session)</div>
        <app-equity-sparkline></app-equity-sparkline>
    </div>
</div>

<div class="grid" style="margin-top:12px">
    <div class="cell" style="grid-column: span 3; text-align:center;">
        <button mat-raised-button color="warn" (click)="panicSell()" [disabled]="!running">PANIC SELL</button>
    </div>
</div>
